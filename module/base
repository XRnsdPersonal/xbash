#! /bin/bash
#####---------------------流程函数---------------------------#########
ftTimeLong()
{
   #时间少于1秒默认不显示操作耗时
   #时间时分秒各单位不显示为零的结果
  time2=$(date +%s -d $(date +"%H:%M:%S"))
  time3=$(((time2-mTimeBackupStart)%60))
  time5=$(((time2-mTimeBackupStart)/3600))
  time4=$((((time2-mTimeBackupStart)-time5*3600)/60))
  if [ "$time5" -ne "0" ];
    then strS1=$time5时
    else strS1=""
  fi
  if [ "$time4" -ne "0" ];
    then strF1=$time4分
    else strF1=""
  fi
  if [ "$time3" -ne "0" ];
    then strM1=$time3秒
    else strM1=""
  fi
  if [ "$time3" -eq "0" ]&&[ "$time4" -eq "0" ] &&[ "$time5" -eq "0" ];
    then echo;echo;echo 1秒没到就结束了
    else echo 本技能耗时${strS1}${strF1}${strM1} ！
  fi
}

ftWhoAmI1()## #命令权限判定
{
  for cmd in ${mCmdsPermissionBase[@]}
      do
          if [ "$cmd" = "$mBaseShellParameter2" ];
            then commandAuthority=base
          fi
      done

      for cmd in ${mCmdsPermissionRoot[@]}
      do
          if [ "$cmd" = "$mBaseShellParameter2" ];
            then commandAuthority=root
          fi
      done
  }

ftWhoAmYou()
{
  if [ `whoami` != "root" ]&&[ "$commandAuthority" = "root" ]; then
    echo "当前用户权限过低，请转换为root 用户后重新运行" ;exit
  fi
  if [ `whoami` = "root" ]&&[ "$commandAuthority" = "base" ];  then
      echo "转化普通用户后，再次尝试"; exit
  fi
}


  
ftEcho()
{
#=================== example=============================
#
#   ftEcho [option] [Content] 
#   ftEcho e 错误的选择1 
#=========================================================
  option=$1
  Content=$2
  while true; do
  case $option in
    y | Y | -y | -Y)  echo -en "${Content}[y/n]"; break;;
    e | E | -e | -E)  echo -e "\033[31m$Content\033[0m"; break;;
    s | S | -s | -S)  echo;echo -e "\033[44m$Content\033[0m"; break;;
    t | T | -t | -T)  echo -e "\e[41;33;1m =========== $Content ============= \e[0m"; break;;
    b | B | -b | -B)  echo;echo -e "\e[41;33;1m =========== $Content ============= \e[0m";echo; break;;
              g | G | -g | -G)
cat<<EOF
    =========================================================================
    命令  --- 参数/命令说明
          |// 使用格式
          |-- 参数1   ---------------- [参数权限] ----  参数说明
    =========================================================================
EOF
break;;
    * ) echo $option ;break;;
  esac
  done
}

ftMain()
{
    ftWhoAmI1
    while true; do
    case $mBaseShellParameter2 in
        "test")                           ${mDirPathCmdTools}test.sh                                           ;break;;
        "help")                          ftReadMe $mBaseShellParameter3                                  ;break;;
        v | V | -v |-V)                echo \"Xrnsd extensions to bash\" V0.5.0beta              ;break;;
        *)
              #权限约束开始
               if [ "$commandAuthority" = "root" ]&&[ `whoami` = "root" ]; then
                    while true; do
                    case $mBaseShellParameter2 in
                    "backup")         ${mDirPathCmdTools}system_backup_restore.sh backup; break;;
                    "restore")          ${mDirPathCmdTools}system_backup_restore.sh restore; break;;
                    esac
                    done
              elif [ "$commandAuthority" = "base" ]&&[ `whoami` = "base" ]; then
                    while true; do
                    case $mBaseShellParameter2 in
                    "clean_data_garbage")   ftCleanDataGarbage ; break;;
                    "mtk_flashtool")      ftMtkFlashTool ; break;;
                    "restartadb")       ftRestartadb1; break;;
                    # "gjh")          java -jar ${mDirPathUserHome}/tools/xls2values/androidi18nBuilder.jar; break;;
                    "monkey")         ftKillPhoneAppByPackageName com.android.commands.monkey; break;;
                    "systemui")         ftKillPhoneAppByPackageName com.android.systemui; break;;
                    "launcher")         ftKillPhoneAppByPackageName com.android.launcher3; break;;
                    esac
                    done
              #权限约束结束
              elif [ ${#mBaseShellParameter2} == 0 ]; then
                    ftReadMe -a
              else
                    while true; do
                    case $XCMD in
                    "xk")   ftKillPhoneAppByPackageName $mBaseShellParameter2; break;;
                    *)        ftEcho -e "   没有有效的命令参数，请查看下面的说明";ftReadMe $XCMD; break;;
                    esac
                    done
              fi
      ftWhoAmYou;break;;
      esac
      done

}

ftReadMe()
{
    while true; do
       case "$1" in
       a | A | -a |-A)
  cat<<EOF
    =========================================================================
    命令  --- 参数/命令说明
          |// 使用格式
          |-- 参数1   ---------------- [参数权限] ----  参数说明
    =========================================================================
    xb  ----- 系统维护
          |// xb ×××××
          |
          |-- backup  ---------------- [root] ------  备份系统
          |-- restore  ---------------- [root] ------  还原系统
    xc  ----- 常规自定义命令和扩展
          |// xc ×××××
          |
          |-- test   -------------------------------   shell测试
          |-- clean_data_garbage                       清空回收站
          |-- restartadb  --------------------------   重启adb服务
          |-- v ------------------------------------   自定义命令版本                                         
          |-- help                                     查看自定义命令说明
          |-- gjh  ---------------------------------   生成国际化所需的xml文件
    xk  ----- 关闭手机指定进程
          |// xk ×××××
          |
          |-- monkey  -------------------------------  关闭monkey
          |-- systemui  -----------------------------  关闭systemui
    xl ----- 过滤 android 含有tag的所有等级的log
          |// xl tag
          |
    xt ----- 检测shell脚本，语法检测和测试运行
          |// xt 脚本文件名
          |
    //xg  ---- [无参] / 搜索文件里面的字符串
          |// xg 字符串
          |
    xle ----- 过滤 android 含有tag的E级log
          |// xle tag
          |
    xkd  ---- [无参] / 快速删除海量文件
          |// xkd 文件夹
          |
    xbh ----- 根据标签过滤命令历史
          |// xbh 标签
          |
    xp ----- 查看文件绝对路径
          |// xp 文件名
          |
    xh ----- 查看具体命令说明
          |// xh 命令名
          |
    xi  ---- [无参] / 快速初始化模块编译环境
    xr  ---- [无参] / 使.bashrc修改生效
    .   ---- [无参] / 进入上一级目录
    ..  ---- [无参] / 进入上两级目录
    xd  ---- [无参] / mtk下载工具
    xu  ---- [无参] / 打开.bashrc
    .9  ---- [无参] / 打开.9工具
    xx  ---- [无参] / 休眠
    xs  ---- [无参] / 关机
    xss ---- [无参] / 重启
    
    ===============  临时命令 ===================
    xversion--[无参] / 查看软件版本
    xg6572 ----- 下载mtk6572的工程
          |// xg6572 分支名
EOF
break;;
       xc |test | clean_data_garbage|restartadb | help | gjh)ftEcho -g;
cat<<EOF
    xc  ----- 常规自定义命令和扩展
          |// xc ×××××
          |
          |-- test   -------------------------------   shell测试
          |-- clean_data_garbage                       清空回收站
          |-- restartadb  --------------------------   重启adb服务
          |-- v ------------------------------------   自定义命令版本                                         
          |-- help                                     查看自定义命令说明
          |-- gjh  ---------------------------------   生成国际化所需的xml文件
EOF
break;;
       xb | backup | restore)ftEcho -g;
cat<<EOF
    xb  ----- 系统维护
          |// xb ×××××
          |
          |-- backup  ---------------- [root] ------  备份系统
          |-- restore  ---------------- [root] ------  还原系统
EOF
break;;
       xk | monkey | systemui)ftEcho -g;
cat<<EOF
    xk  ----- 关闭手机指定进程
          |// xk ×××××
          |
          |-- monkey  -------------------------------  关闭monkey
          |-- systemui  -----------------------------  关闭systemui
EOF
break;;
       xl)
cat<<EOF
    xl ----- 过滤 android 含有tag的所有等级的log
          |// xl tag
EOF
break;;
       xt)
cat<<EOF
    xt ----- 检测shell脚本，语法检测和测试运行
          |// xt 脚本文件名
EOF
break;;
       xg)
cat<<EOF
    //xg  ---- [无参] / 搜索文件里面的字符串
          |// xg 字符串
EOF
break;;
       xle)
cat<<EOF
    xle ----- 过滤 android 含有tag的E级log
          |// xle tag
EOF
break;;
       xkd)
cat<<EOF
    xkd  ---- [无参] / 快速删除海量文件
          |// xkd 文件夹
EOF
break;;
       xbh)
cat<<EOF
    xbh ----- 根据标签过滤命令历史
          |// xbh 标签
EOF
break;;
       xp)
cat<<EOF
    xp ----- 查看文件绝对路径
          |// xp 文件名
EOF
break;;
       xh)
cat<<EOF
    xh ----- 查看具体命令说明
          |// xh 命令名
EOF
break;;
       xi)
cat<<EOF
    xi  ---- [无参] / 快速初始化模块编译环境
EOF
break;;
       xr)
cat<<EOF
   xr  ---- [无参] / 使.bashrc修改生效
EOF
break;;
       xd)
cat<<EOF
    xd  ---- [无参] / mtk下载工具
EOF
break;;
       xu)
cat<<EOF
    xu  ---- [无参] / 打开.bashrc
EOF
break;;
       xx)
cat<<EOF
    xx  ---- [无参] / 休眠
EOF
break;;
       xs)
cat<<EOF
    xs  ---- [无参] / 关机
EOF
break;;
       xss)
cat<<EOF
    xss ---- [无参] / 重启
EOF
break;;
       *)ftReadMe -a;break;;
       esac
    done
  }
